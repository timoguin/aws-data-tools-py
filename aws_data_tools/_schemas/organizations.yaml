# This schema is a container that represents all the type objects belonging to an AWS
# Organization. All the individual schemas are defined under the "definitions" key.
---
title: Organization Schemas
type: object
oneOf:
    - {"$ref": "#/definitions/Account"}
    - {"$ref": "#/definitions/Child"}
    - {"$ref": "#/definitions/EffectivePolicy"}
    - {"$ref": "#/definitions/Organization"}
    - {"$ref": "#/definitions/OrganizationalUnit"}
    - {"$ref": "#/definitions/Parent"}
    - {"$ref": "#/definitions/Policy"}
    - {"$ref": "#/definitions/PolicySummary"}
    - {"$ref": "#/definitions/PolicyTargetSummary"}
    - {"$ref": "#/definitions/PolicyTypeSummary"}
    - {"$ref": "#/definitions/Root"}
    - {"$ref": "#/definitions/Tag"}
definitions:
    Account:
        title: Account
        id: Account
        type: object
        required: ["arn", "email", "id", "joined_method", "joined_timestamp", "name", "status"]
        properties:
            effective_policies:
                description: A list of effective policy objects associated with the account
                type: array
                items: {"$ref": "#/definitions/EffectivePolicy"}
            arn:
                description: The Amazon Resource Name (ARN) of the account
                type: string
            email:
                description: The email address associated with AWS account
                type: string
            id:
                description: The unique identifier (ID) of the account
                type: string
            joined_method:
                description: The method by which the account joined the organization
                type: string
                enum: ["CREATED", "INVITED"]
            joined_timestamp:
                description: The date the account became a part of the organization
                type: string
            name:
                description: The friendly name of the account
                type: string
            status:
                description: The status of the account in the organization
                type: string
                enum: ["ACTIVE", "SUSPENDED"]
            parent:
                description: The parent entity of the account
                $ref: "#/definitions/Parent"
            policies:
                description: A list of policy objects associated with the OU
                type: array
                items: {"$ref": "#/definitions/Policy"}
            tags:
                description: A list of tag objects associated with the account
                type: array
                items: {"$ref": "#/definitions/Tag"}

    Child:
        title: Child
        id: Child
        type: object
        required: ["id", "type"]
        properties:
            id:
                description: The unique identifier (ID) of the child
                type: string
            type:
                description: The type of the child
                type: string
                enum: ["ACCOUNT", "ORGANIZATIONAL_UNIT", "ROOT"]

    EffectivePolicy:
        title: Effective Policy
        id: EffectivePolicy
        type: object
        required: ["last_updated_timestamp", "policy_content", "policy_type", "target_id"]
        properties:
            last_updated_timestamp:
                description: The time of the last update to the policy
                type: string
            policy_content:
                description: The text content of the policy
                type: string
            policy_type:
                description: The type of the policy
                type: string
                enum: ["AISERVICES_OPT_OUT_POLICY", "BACKUP_POLICY", "TAG_POLICY"]
            target_id:
                description: The unique identifier (ID) of the policy target
                type: string

    Organization:
        title: Organization
        id: Organization
        type: object
        required: ["arn", "available_policy_types", "feature_set", "id", "master_account_arn", "master_account_email", "master_account_id"]
        properties:
            # Required properties
            arn:
                description: The Amazon Resource Name (ARN) of the organization.
                type: string
            available_policy_types:
                description: A list of policy type summaries for the organization
                type: array
                items: {"$ref": "#/definitions/PolicyTypeSummary"}
            feature_set:
                description: The features enabled for the organization
                type: string
                enum: ["ALL", "CONSOLIDATED_BILLING"]
            id:
                description: The unique identifier (ID) of the organization
                type: string
            master_account_arn:
                description: The ARN of the master account of the organization
                type: string
            master_account_email:
                description: The root email for the master account of the organization
                type: string
            master_account_id:
                description: The account ID for the master account of the organization
                type: string
            accounts:
                description: A list of account objects for the organization
                type: array
                items: {"$ref": "#/definitions/Account"}
            organizational_units:
                description: A list of OU objects for the organization
                type: array
                items: {"$ref": "#/definitions/OrganizationalUnit"}
            policies:
                description: A list of policy objects for the organization
                type: array
                items: {"$ref": "#/definitions/Policy"}
            roots:
                description: The roots of the organization
                type: array
                items: {"$ref": "#/definitions/Root"}

    OrganizationalUnit:
        title: Organizational Unit
        id: OrganizationalUnit
        type: object
        required: ["arn", "id", "name"]
        properties:
            arn:
                description: The Amazon Resource Name (ARN) of this OU
                type: string
            id:
                descriptio: The unique identifier (ID) associated with the OU
                type: string
            name:
                description: The friendly name of the OU
                type: string
            children:
                description: A list of child entities associated with the OU
                type: array
                items: {"$ref": "#/definitions/Child"}
            effective_policies:
                description: A list of effective policy objects associated with the account
                type: array
                items: {"$ref": "#/definitions/EffectivePolicy"}
            parent:
                description: The parent entity associated with the OU
                $ref: "#/definitions/Parent"
            policies:
                description: A list of policy objects associated with the OU
                type: array
                items: {"$ref": "#/definitions/Policy"}
            tags:
                description: A maps of tag objects associated with the OU
                $ref: "#/definitions/Tag"

    Parent:
        title: Parent
        id: Parent
        type: object
        required: ["id", "type"]
        properties:
            id:
                description: The unique identifier (ID) for the parent entity
                type: string
            type:
                description: The type of the parent entity
                type: string
                enum: ["ROOT", "ORGANIZATION", "ORGANIZATIONAL_UNIT"]

    Policy:
        title: Policy
        id: Policy
        type: object
        required: ["content", "policy_summary"]
        properties:
            content:
                description: The text content of the policy
                type: string
            policy_summary: 
                description: A structure that contains additional details about the policy
                $ref: "#/definitions/PolicySummary"
            tags:
                description: A list of tag objects associated with the policy
                type: array
                items: {"$ref": "#/definitions/Tag"}
            targets:
                description: A list of attached policy targets
                type: array
                items: {"$ref": "#/definitions/PolicyTargetSummary"}

    PolicySummary:
        title: Policy Summary
        id: PolicySummary
        type: object
        required: ["arn", "aws_managed", "description", "id", "name", "type"]
        properties:
            arn:
                description: The Amazon Resource Name (ARN) of the policy
                type: string
            aws_managed:
                description: Specifies if the policy is an AWS managed policy
                type: boolean
            description:
                description: The description of the policy
                type: string
            id:
                description: The unique identifier (ID) of the policy
                type: string
            name:
                description: The friendly name of the policy
                type: string
            type:
                description: The type of the policy
                type: string
                enum: ["AISERVICES_OPT_OUT_POLICY", "BACKUP_POLICY", "SERVICE_CONTROL_POLICY", "TAG_POLICY"]

    PolicyTargetSummary:
        title: Policy Target Summary
        id: PolicyTargetSummary
        type: object
        required: ["arn", "target_id", "name", "type"]
        properties:
            arn:
                description: The Amazon Resource Name (ARN) of the policy target
                type: string
            target_id:
                description: The unique identifier (ID) of the policy target
                type: string
            name:
                description: The friendly name of the policy target
                type: string
            type:
                description: The type of the policy target
                type: string
                enum: ["ACCOUNT", "ORGANIZATIONAL_UNIT", "ROOT"]

    PolicyTypeSummary:
        title: Policy Type Summary
        id: PolicyTypeSummary
        type: object
        required: ["status", "type"]
        properties:
            status:
                description: The availability status of a policy type
                type: string
                enum: ["ENABLED", "PENDING_ENABLE", "PENDING_DISABLE"]
            type:
                description: The type of the policy
                type: string
                enum: ["AISERVICES_OPT_OUT_POLICY", "BACKUP_POLICY", "SERVICE_CONTROL_POLICY", "TAG_POLICY"]

    Root:
        title: Root
        id: Root
        type: object
        # required: ["meta"]
        properties:
            children:
                description: A list of child entities associated with the root
                type: array
                items: {"$ref": "#/definitions/Child"}
            effective_policies:
                description: A list of effective policy objects associated with the account
                type: array
                items: {"$ref": "#/definitions/EffectivePolicy"}
            meta:
                definition: Metadata for the root
                type: object
                required: ["arn", "id", "name", "policy_types"]
                properties:
                    arn:
                        description: The ARN for the root of the organization
                        type: string
                    id:
                        description: The ID of the root object for the organization
                        type: string
                    name:
                        description: The name of the organization root
                        type: string
                    policy_types:
                        description: A list of policy type summaries for the organization root
                        type: array
                        items: {"$ref": "#/definitions/PolicyTypeSummary"}
            parent:
                description: The parent entity of the root (the organization ID)
                $ref: "#/definitions/Parent"
            policies:
                description: A list of policy objects associated with the root
                type: array
                items: {"$ref": "#/definitions/Policy"}
            tags:
                description: A list of tag objects associated with the root
                type: array
                items: {"$ref": "#/definitions/Tag"}

    Tags:
        title: Tags
        id: Tags
        type: object

        properties:
            key:
              description: The tag key
              type: string
            value:
              description: The tag value
              type: string
